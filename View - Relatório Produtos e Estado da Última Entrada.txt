CREATE VIEW V_PRODUTO_ESTADO AS
SELECT
  V.LOJCOD		AS LOJA,
  I.REFPLU		AS PLU, 
  P.PRODES		AS DESCRICAO,
  F.FORCOD		AS FORNECEDOR,
  A.AGEEST		AS ESTADO,
  P.TRBID		AS TRIBUTACAO,
  P.SECCOD		AS SECAO,
  P.GRPCOD		AS GRUPO,
  P.SBGCOD		AS SUBGRUPO,
  E.ESTLOJTOT	AS ESTOQUE
FROM 
V_ULTIMA_ENTRADA_LOJA		V
INNER JOIN AGENTE			A	ON V.AGECOD = A.AGECOD
INNER JOIN FORNECEDOR		F	ON A.AGECOD = F.AGECOD
INNER JOIN ITEM_ENTRADA		I	ON V.ENTCOD = I.ENTCOD AND V.LOJCOD = I.LOJCOD AND V.REFPLU = I.REFPLU
INNER JOIN REFERENCIA		R	ON R.REFPLU = I.REFPLU
INNER JOIN PRODUTO			P	ON P.PROCOD = R.PROCOD
INNER JOIN ESTOQUE_LOJA		E	ON E.REFPLU = I.REFPLU AND E.LOJCOD = I.LOJCOD
	

--ENTIDADES
INSERT INTO ENTIDADE (ENTNOM,ENTTIT)  VALUES ('V_PRODUTO_ESTADO', 'Relatório Produtos c/Estado')

--ATRIBUTOS	
INSERT INTO ATRIBUTO (ENTNOM,ATRNOM,ATRTIT,ATRTIP,ATRTMN,ATRMSK,ATRFMTZERESQ) VALUES ('V_PRODUTO_ESTADO','LOJA','Código da loja','S',6,'999999;0;_','S')
INSERT INTO ATRIBUTO (ENTNOM,ATRNOM,ATRTIT,ATRTIP,ATRTMN,ATRMSK,ATRFMTZERESQ) VALUES ('V_PRODUTO_ESTADO','PLU','PLU','S',6,'999999;0;_','S')
INSERT INTO ATRIBUTO (ENTNOM,ATRNOM,ATRTIT,ATRTIP,ATRTMN,ATRMSK,ATRFMTZERESQ) VALUES ('V_PRODUTO_ESTADO','DESCRICAO','Descrição','S',50,NULL,'N')
INSERT INTO ATRIBUTO (ENTNOM,ATRNOM,ATRTIT,ATRTIP,ATRTMN,ATRMSK,ATRFMTZERESQ) VALUES ('V_PRODUTO_ESTADO','FORNECEDOR','Código fornecedor','S',6,'999999;0;_','S')
INSERT INTO ATRIBUTO (ENTNOM,ATRNOM,ATRTIT,ATRTIP,ATRTMN,ATRMSK,ATRFMTZERESQ) VALUES ('V_PRODUTO_ESTADO','ESTADO','Estado','S',2,NULL,'N')
INSERT INTO ATRIBUTO (ENTNOM,ATRNOM,ATRTIT,ATRTIP,ATRTMN,ATRMSK,ATRFMTZERESQ) VALUES ('V_PRODUTO_ESTADO','TRIBUTACAO','Tributação','S',3,'A99;0;_','S')
INSERT INTO ATRIBUTO (ENTNOM,ATRNOM,ATRTIT,ATRTIP,ATRTMN,ATRMSK,ATRFMTZERESQ) VALUES ('V_PRODUTO_ESTADO','SECAO','Código da seção','S',2,'99;0;_','S')
INSERT INTO ATRIBUTO (ENTNOM,ATRNOM,ATRTIT,ATRTIP,ATRTMN,ATRMSK,ATRFMTZERESQ) VALUES ('V_PRODUTO_ESTADO','GRUPO','Código grupo','S',3,'999;0;_','S')
INSERT INTO ATRIBUTO (ENTNOM,ATRNOM,ATRTIT,ATRTIP,ATRTMN,ATRMSK,ATRFMTZERESQ) VALUES ('V_PRODUTO_ESTADO','SUBGRUPO','Código subgrupo','S',3,'999;0;_','S')
INSERT INTO ATRIBUTO (ENTNOM,ATRNOM,ATRTIT,ATRTIP,ATRTMN,ATRMSK,ATRPRC,ATRFMTZERESQ,ATRFMTEXB) VALUES ('V_PRODUTO_ESTADO','ESTOQUE','Estoque total','F',12,3,NULL,'N',',0.000')

SELECT * FROM ATRIBUTO WHERE ENTNOM = 'V_PRODUTO_ESTADO'