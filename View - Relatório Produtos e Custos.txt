CREATE VIEW V_PRODUTOS_CUSTOS AS
SELECT
  L.LOJCOD AS LOJA,
  R.REFPLU AS PLU,
  R.REFDES AS DESCRICAO,
  COALESCE(P.PRCVDA1, 0) AS VAREJO,
  COALESCE(C.CSTREP, 0) AS CUSTO_REPOSICAO,
  COALESCE(C.CSTSEMIMP, 0) AS CUSTO_SEM_IMPOSTOS,
  COALESCE(C.CSTMEDFSC, 0) AS CUSTO_MEDIO
 FROM CUSTO C WITH (NOLOCK)
INNER JOIN V_LOJA L WITH (NOLOCK)
  ON (C.LOJCOD = L.LOJCOD)
INNER JOIN PRECO P WITH (NOLOCK)
  ON P.LOJCOD = L.LOJCOD AND P.REFPLU = C.REFPLU
INNER JOIN REFERENCIA R WITH (NOLOCK)
  ON (C.REFPLU = R.REFPLU)
INNER JOIN PRODUTO PR WITH (NOLOCK)
  ON (R.PROCOD = PR.PROCOD)


--ENTIDADES
INSERT INTO ENTIDADE (ENTNOM,ENTTIT)  VALUES ('V_PRODUTOS_CUSTOS', 'Relatório de Produtos e Custos')

--ATRIBUTOS	
INSERT INTO ATRIBUTO (ENTNOM,ATRNOM,ATRTIT,ATRTIP,ATRTMN,ATRMSK,ATRFMTZERESQ) VALUES ('V_PRODUTOS_CUSTOS','LOJA','Loja','S',6,'999999;0;_','S')
INSERT INTO ATRIBUTO (ENTNOM,ATRNOM,ATRTIT,ATRTIP,ATRTMN,ATRMSK,ATRFMTZERESQ) VALUES ('V_PRODUTOS_CUSTOS','PLU','PLU','S',6,'999999;0;_','S')
INSERT INTO ATRIBUTO (ENTNOM,ATRNOM,ATRTIT,ATRTIP,ATRTMN,ATRMSK,ATRFMTZERESQ) VALUES ('V_PRODUTOS_CUSTOS','DESCRICAO','Descrição','S',120,NULL,'N')
INSERT INTO ATRIBUTO (ENTNOM,ATRNOM,ATRTIT,ATRTIP,ATRTMN,ATRPRC,ATRMSK,ATRFMTZERESQ,ATRFMTEXB) VALUES ('V_PRODUTOS_CUSTOS','VAREJO','Preço venda 1','F',15,6,NULL,'N','0.00')
INSERT INTO ATRIBUTO (ENTNOM,ATRNOM,ATRTIT,ATRTIP,ATRTMN,ATRPRC,ATRMSK,ATRFMTZERESQ) VALUES ('V_PRODUTOS_CUSTOS','CUSTO_REPOSICAO','Custo reposição','F',18,6,NULL,'N')
INSERT INTO ATRIBUTO (ENTNOM,ATRNOM,ATRTIT,ATRTIP,ATRTMN,ATRPRC,ATRMSK,ATRFMTZERESQ) VALUES ('V_PRODUTOS_CUSTOS','CUSTO_SEM_IMPOSTOS','Custo sem impostos','F',18,6,NULL,'N')
INSERT INTO ATRIBUTO (ENTNOM,ATRNOM,ATRTIT,ATRTIP,ATRTMN,ATRPRC,ATRMSK,ATRFMTZERESQ) VALUES ('V_PRODUTOS_CUSTOS','CUSTO_MEDIO','Custo Médio físico','F',18,6,NULL,'N')

